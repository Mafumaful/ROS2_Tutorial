# A* Algorithm Interactive Step-by-Step Debugger

## 概述

这个交互式调试工具可以帮助学生深入理解A*算法的执行过程，通过单步查看算法的每一步来学习：
- Open List 和 Closed Set 如何变化
- 节点的 f, g, h 值如何计算
- 路径如何逐步构建
- 算法如何选择最优节点进行扩展

## 使用方法

### 方法 1: 运行专用的调试演示

```bash
python examples/lesson1_debug.py
```

这将启动一个简化的地图，专门用于单步调试演示。

### 方法 2: 在主演示中启用调试模式

```bash
python examples/lesson1_demo.py --debug
# 或
python examples/lesson1_demo.py -d
```

这将在主演示中启用单步调试模式，使用与正常演示相同的地图。

## 键盘控制

| 按键 | 功能 |
|------|------|
| `→` 或 `D` | 前进一步 |
| `←` 或 `A` | 后退一步 |
| `Home` | 跳到第一步 |
| `End` | 跳到最后一步 |

## 可视化元素说明

| 元素 | 颜色/标记 | 说明 |
|------|----------|------|
| 起点 | 🟢 绿色圆圈 | 路径规划的起始位置 |
| 终点 | ⭐ 红色星号 | 路径规划的目标位置 |
| 障碍物 | ⬛ 灰色方块 | 不可通行的区域 |
| Closed Set | 🔵 浅蓝色方块 | 已经访问并扩展过的节点 |
| Open List | 🟡 黄色方块 | 等待扩展的节点（候选节点） |
| 当前节点 | 🟠 橙色星号 | 当前正在扩展的节点 |
| 当前路径 | 🟢 绿色线条 | 从起点到当前节点的最优路径 |

## 观察要点

在使用单步调试器时，注意观察以下几点：

### 1. 节点选择策略
- 每一步都选择 Open List 中 f 值最小的节点
- f = g + h，其中：
  - g: 从起点到当前节点的实际代价
  - h: 从当前节点到终点的启发式估计

### 2. Open List 的变化
- 当扩展一个节点时，它从 Open List 移到 Closed Set
- 该节点的所有有效邻居被加入 Open List（如果更优）

### 3. Closed Set 的扩展
- Closed Set 逐步扩大，表示已探索的区域
- 已在 Closed Set 中的节点不会被重复访问

### 4. 路径构建
- 绿色路径显示从起点到当前节点的最优路径
- 通过 parent 指针回溯构建
- 路径会随着找到更优解而更新

### 5. 启发式函数的作用
- h 值引导搜索朝向目标
- 观察搜索如何"直奔"目标而不是盲目扩散

## 教学建议

### 初学者
1. 先运行几次完整演示，观察最终结果
2. 使用单步调试器从头到尾走一遍
3. 重点关注 f, g, h 值的变化
4. 观察为什么某些节点被选中，某些被忽略

### 进阶学生
1. 对比不同启发式权重的搜索过程
2. 修改地图，观察算法如何应对不同障碍物
3. 分析搜索效率：扩展了多少节点才找到路径
4. 思考：如果没有启发式函数（h=0），搜索会如何进行？

## 代码实现

如果你想在自己的代码中使用这个调试工具：

```python
from algorithms.a_star import AStar, create_grid_map
from utils.visualization import AStarStepVisualizer

# 创建地图
grid = create_grid_map(20, 20, obstacles=[...])

# 创建规划器并执行（记录每一步）
planner = AStar(grid, start=(2,2), goal=(17,17))
path = planner.plan(record_steps=True)  # 重要：启用 record_steps

# 创建并显示可视化
if planner.steps:  # 确保记录了步骤
    visualizer = AStarStepVisualizer(planner)
    visualizer.show()
```

## 常见问题

**Q: 为什么中文显示不正常？**
A: 这是字体问题，不影响功能使用。可以通过安装中文字体解决，但不是必须的。

**Q: 可以保存调试过程吗？**
A: 当前版本不支持自动录制，但你可以在每一步截图来记录关键步骤。

**Q: 如何修改地图来测试不同场景？**
A: 编辑 `lesson1_debug.py` 中的 `obstacles` 列表，或修改 `start` 和 `goal` 位置。

**Q: 能不能只看某几步？**
A: 使用 Home/End 键快速跳转，或使用方向键快速前进/后退。

## 技术实现细节

- **步骤记录**：在 AStar.plan() 方法中，当 `record_steps=True` 时，每扩展一个节点就记录当前状态
- **交互控制**：使用 matplotlib 的事件处理系统捕获键盘输入
- **实时更新**：每次按键后清空画布并重新绘制当前步骤的状态
- **内存优化**：只在需要时记录步骤，正常规划模式下不产生额外开销

## 扩展练习

1. 修改 `AStarStepVisualizer` 类，添加自动播放功能
2. 实现导出功能，保存每一步为图片序列
3. 添加统计面板，显示实时的节点扩展数量和效率
4. 支持鼠标点击节点查看详细信息
